{% extends 'home/base.html' %}

{% block title %}{{ product.name }} - My Ecommerce{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <!-- Images Carousel -->
        <div class="col-md-6">
            {% if images %}
            <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                    {% for img in images %}
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        <img src="{{ img.image.url }}" class="d-block w-100" alt="{{ img.alt_text|default:product.name }}">
                    </div>
                    {% endfor %}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon"></span>
                </button>
            </div>
            {% else %}
                <p>No images available.</p>
            {% endif %}
        </div>

        <!-- Product Details -->
        <div class="col-md-6">
            <h2>{{ product.name }}</h2>
            <p class="text-muted">SKU: {{ product.sku }}</p>
            <p class="fw-bold text-success">Price: ₹{{ product.price }}</p>
            {% if product.discount_price %}
            <p class="text-decoration-line-through text-muted">Discounted from ₹{{ product.discount_price }}</p>
            {% endif %}
            <p>{{ product.description }}</p>

            {% if attributes %}
            <h5>Specifications:</h5>
            <ul>
                {% for attr in attributes %}
                <li><strong>{{ attr.key }}:</strong> {{ attr.value }}</li>
                {% endfor %}
            </ul>
            {% endif %}

            {% if variants %}
            <h5>Variants:</h5>
            <ul>
                {% for var in variants %}
                <li>{{ var.name }}: {{ var.value }} {% if var.price %} (₹{{ var.price }}) {% endif %}</li>
                {% endfor %}
            </ul>
            {% endif %}

                              {% if user.is_authenticated %}
<form action="{% url 'cart:add_to_cart' product.pk %}" method="POST">
    {% csrf_token %}
    <button type="submit" class="btn btn-sm btn-warning w-100 mt-2">
        <i class="fas fa-shopping-cart me-1"></i> Add to Cart
    </button>
</form>
{% else %}
<a href="{% url 'accounts:login' %}?next={{ request.path }}" class="btn btn-sm btn-warning w-100 mt-2">
    <i class="fas fa-shopping-cart me-1"></i> Add to Cart
</a>
{% endif %}

        </div>
    </div>
</div>
{% endblock %}
